import PartySocket from "partysocket";
import { WebSocketServer } from "ws";

// PartyKit server - handles WebSocket relay between host and client
export default {
  async onConnect(conn, room, ctx) {
    console.log(`Client connected: ${conn.id}`);
  },

  async onMessage(message, sender, room) {
    // Broadcast message to all other connections in the room
    // Message format: { type: "host" | "client", data: any }
    const payload = JSON.stringify({
      sender: sender.id,
      data: JSON.parse(message),
    });

    // Broadcast to all other clients in the room
    room.broadcast(payload, [sender.id]);
  },

  async onClose(conn, room, ctx) {
    console.log(`Client disconnected: ${conn.id}`);
  },
};

